#### λ‚ μ§: 2024-05-04

<br/>

### π¤οΈ μ¤ν¬λΌ

-   ν•™μµ λ©ν‘ 1 : μ»¤λ®¤λ‹ν‹°μ›Ή μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈ μ—°κ²°
    1. user κ΄€λ¦¬ API
    2. κ²μ‹κΈ€ κ΄€λ¦¬ API

<br/>

### β΅οΈ μƒλ΅ λ°°μ΄ λ‚΄μ©

#### 1. node.jsμ—μ„ .env νμΌλ΅ ν™κ²½λ³€μ κ΄€λ¦¬ν•κΈ°

-   ν™κ²½ λ³€μλ¥Ό μ‚¬μ©ν•λ” μ΄μ 
    -   λ³΄μ•
    -   ν™κ²½μ— λ”°λ¥Έ μ„¤μ •
    -   μ½”λ“μ κ°€λ…μ„±
-   ν™κ²½ λ³€μλ¥Ό μ‚¬μ©ν•λ” λ°©λ²•
    -   `dotenv` ν¨ν‚¤μ§€ μ„¤μΉ
    -   `.env` νμΌ μƒμ„±
    -   `process.env` κ°μ²΄λ¥Ό ν†µν•΄ ν™κ²½ λ³€μ μ‚¬μ©
    -   githubμ—λ” μ‹¤μ  `.env` νμΌμ€ μ¬λ¦¬μ§€ μ•κ³ , `.env.example` νμΌμ„ μƒμ„±ν•μ—¬ μ¬λ¦°λ‹¤.

```javascript
// .env
PORT = 8000;

// server.js
require("dotenv").config(); // κ³µμ‹ν™νμ΄μ§€μ„ μ•λ‚΄ν•λ” ν‘μ¤€ config λ°©μ‹
const port = process.env.PORT;
```

<br/>

### π”¥ μ¤λμ λ„μ „ κ³Όμ μ™€ ν•΄κ²° λ°©λ²•

#### λ„μ „ κ³Όμ  1: cors μ—λ¬ ν•΄κ²°ν•κΈ°

-   μƒν™©  
    μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈλ¥Ό μ—°κ²°ν•κ³ , ν΄λΌμ΄μ–ΈνΈμ—μ„ μ„λ²„λ΅ μ”μ²­μ„ λ³΄λ‚΄λ”λ° cors μ—λ¬κ°€ λ°μƒν–λ‹¤.

    ```plaintext
    Access to fetch at 'http://localhost:8000/users/signin' from origin 'http://localhost:3000' has been blocked by CORS policy: Response to preflight request doesn't pass access control check: No 'Access-Control-Allow-Origin' header is present on the requested resource. If an opaque response serves your needs, set the request's mode to 'no-cors' to fetch the resource with CORS disabled.
    ```

-   μλ„  
    corsμ—λ¬κ°€ μ–΄λ–¤ μ—λ¬μΈμ§€ μ•μ•κΈ°μ—, credentials ν—¤λ”λ¥Ό μ¶”κ°€ν•μ—¬ ν•΄κ²°ν•΄λ³΄λ ¤κ³  ν–λ‹¤.

-   λ°©λ²•  
    credentials ν—¤λ” λΏλ§ μ•„λ‹λΌ, μ„λ²„μ—μ„ cors λ―Έλ“¤μ›¨μ–΄λ¥Ό μ¶”κ°€ν•΄μ£Όμ–΄μ•Ό ν•λ‹¤.

1. `fetch.js` - credentials ν—¤λ” μ¶”κ°€

    ```javascript
    export async function fetchRaw(url, method, data) {
        const requestUrl = BASE_URL + url;

        return fetch(requestUrl, {
            method: method,
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify(data),
            credentials: "include", // μ¶”κ°€
        }).then((res) => {
            if (res.ok) {
                return res.json();
            } else {
                throw new Error("API Error");
            }
        });
    }
    ```

2. `server.js` - cors λ―Έλ“¤μ›¨μ–΄ μ¶”κ°€

    ```javascript
    const cors = require("cors");
    app.use(
        cors({
            origin: "http://localhost:3000", // origin: ν΄λΌμ΄μ–ΈνΈ μ£Όμ†
            credentials: true,
        })
    );
    ```

#### λ„μ „ κ³Όμ  2: ν΄λΌμ΄μ–ΈνΈ μ”μ²­ λ°”λ””μ— formData λ‹΄κΈ°

-   μƒν™©  
     5μ›” 1μΌμ— μ•μ•„λ³Έ λ°”μ— μν•λ©΄, ν΄λΌμ΄μ–ΈνΈ μ”μ²­ μ‹μ— ν—¤λ”μ— `Content-Type`μ„ `multipart/form-data`λ΅ μ§€μ •ν•΄μ£Όμ–΄μ•Ό ν•λ‹¤κ³  ν–λ‹¤. ν—¤λ” μ§€μ • ν›„ μ”μ²­μ„ ν•΄λ³΄λ‹ μ•„λμ™€ κ°™μ€ μ—λ¬κ°€ λ°μƒν–λ‹¤.
    `   Error: Multipart: Boundary not found
at new Multipart (/Users/jamie/KakaoCloudSchool/community-web-js/backend-server/node_modules/busboy/lib/types/multipart.js:233:13)`
-   λ°©λ²•  
    **fetch μ‚¬μ©μ‹, headers ν•­λ©μ„ λΉ„μ°κ³  bodyμ— FormDataκ°μ²΄λ¥Ό λ‹΄μ•„ μ „μ†΅ν•λ‹¤.**
    axios μ‚¬μ©μ‹μ—λ§ headersμ— `Content-Type`μ„ `multipart/form-data`λ΅ μ§€μ •ν•΄μ£Όλ©΄ λλ‹¤.

    ```javascript
    export async function fetchForm(url, method, data) {
        const requestUrl = BASE_URL + url;

        return fetch(requestUrl, {
            // headers ν•­λ©μ„ λΉ„μ›μ¤€λ‹¤.
            method: method,
            body: data,
            credentials: "include",
        }).then((res) => {
            if (res.ok) {
                return res.json();
            } else {
                throw new Error("API Error");
            }
        });
    }
    ```

<br/>

### π¤” μ¤λμ νκ³ 

-   μ¤ν¬λΌ μ¤‘ μ™„λ£ν• μ‘μ—…: `user κ΄€λ¦¬ API` - `νμ›κ°€μ…`, `λ΅κ·ΈμΈ` μ™„λ£
-   λ°”λ‹λΌJSμ™€ expressμ μ„λ²„ μΈ΅ μ½”λ“μ™€ cors μ„¤μ • λ“± λ¨λ‘ λ‹¤ μ²μ μ ‘ν•λ” λ¶„μ•Όμ΄λ‹¤λ³΄λ‹ μ›λ μ•λ κ°λ…λ“¤λ„ μ μ©ν•λ” λ°μ— μ‹κ°„μ΄ μ¤λ κ±Έλ¦¬λ” κ²ƒ κ°™λ‹¤. μ΄λ² μ£Ό μ•μ— μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈ μ—°κ²°μ„ μ™„λ£ν•΄μ•Ό ν•λ―€λ΅, μ—΄μ‹¬ν μ§„ν–‰ν•΄μ•Όκ² λ‹¤.
-   μ„λ²„ κµ¬ν„ κ³Όμ λ¥Ό ν•λ©΄μ„ λ‹¤λ¥Έ ν€μ›μ μ½”λ“λ¥Ό λ§μ΄ μ°Έκ³ ν•κ² λλ” κ²ƒ κ°™λ‹¤. μ½”λ“λ¥Ό λ³΄λ©΄μ„ μ–΄λ–»κ² κµ¬μ΅°ν™”μ‹ν‚¤λ©΄ μΆ‹μ„μ§€, μ–΄λ–¤ λ°©μ‹μΌλ΅ μ½”λ“λ¥Ό μ‘μ„±ν•λ”μ§€ λ“±μ„ λ°°μΈ μ μμ—λ κ²ƒ κ°™λ‹¤.
-   λ§¤λ² μ¤ν¬λΌμ„ λ¨λ‘ μ™„λ£ν•μ§€ λ»ν•λ” κ²ƒμ΄ μ•„μ‰½λ‹¤. ν„μ‹¤μ„± μλ” λ©ν‘λ¥Ό μ„Έμ°κ³ , κ·Έ λ©ν‘λ¥Ό λ‹¬μ„±ν•κΈ° μ„ν•΄ λ…Έλ ¥ν•΄μ•Όκ² λ‹¤.

<br/>

### μ°Έκ³  μλ£ λ° λ§ν¬

-   [multipart error ν•΄κ²°](https://rgbitcode.com/blog/senspond/59)
