#### ë‚ ì§œ: 2024-05-01

<br/>

### ğŸŒ¤ï¸ ìŠ¤í¬ëŸ¼

-   í•™ìŠµ ëª©í‘œ 1 : ì»¤ë®¤ë‹ˆí‹°ì›¹ express ì„œë²„ êµ¬í˜„

<br/>

### âš¡ï¸ ìƒˆë¡œ ë°°ìš´ ë‚´ìš©

#### 1. Multer

-   íŒŒì¼ ì—…ë¡œë“œë¥¼ ìœ„í•´ ì‚¬ìš©ë˜ëŠ” ë¯¸ë“¤ì›¨ì–´
-   `multipart/form-data` í˜•ì‹ì˜ ë°ì´í„°ë¥¼ ë‹¤ë£¨ê¸° ìœ„í•´ ì‚¬ìš©í•œë‹¤.
-   `req.file`ë¡œ íŒŒì¼ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

`routes/router.js`

```javascript
// ES6
import multer from "multer";
// CommonJS
const multer = require("multer");

// íŒŒì¼ ì—…ë¡œë“œë¥¼ ìœ„í•œ ë¯¸ë“¤ì›¨ì–´ ìƒì„±
const upload = multer({ dest: "uploads/" });

//  .single() : ì´ë¯¸ì§€ë¥¼ req.fileì— ì €ì¥í•˜ì—¬ next middlewareë¡œ ì „ë‹¬
// "image" : form-dataì˜ key ê°’ (í•„ë“œëª…)
app.post("/upload", upload.single("image"), (req, res) => {
    console.log(req.file);
    res.send("íŒŒì¼ ì—…ë¡œë“œ ì™„ë£Œ");
});
```

<br/>

### ğŸ”¥ ì˜¤ëŠ˜ì˜ ë„ì „ ê³¼ì œì™€ í•´ê²° ë°©ë²•

#### ë„ì „ ê³¼ì œ 1: ì„œë²„ì—ì„œ ì´ë¯¸ì§€ ì²˜ë¦¬í•˜ê¸°

-   ìƒí™©  
    ì–´ì œ í•´ê²°í•˜ì§€ ëª»í–ˆë˜ `ì„œë²„ì—ì„œ formDataë¡œ ë°›ì€ ì´ë¯¸ì§€ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•`ì„ í•´ê²°í•´ì•¼ í•œë‹¤.
-   ì˜ë„  
    `multer`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ë¯¸ì§€ë¥¼ ì„œë²„ë¡œ ì „ì†¡í•˜ê³ , `req.file`ë¡œ ì´ë¯¸ì§€ ì •ë³´ë¥¼ í™•ì¸í•œë‹¤.
-   ë°©ë²•  
    í´ë¼ì´ì–¸íŠ¸ì—ì„œ formDataë¡œ ë°ì´í„°ë¥¼ ì „ì†¡í•´ì£¼ì—ˆë‹¤ëŠ” ê²ƒì„ ê°€ì •í•œë‹¤.  
    **1. formDataì— ì´ë¯¸ì§€ë¥¼ ë‹´ê³  ìš”ì²­ headerì— `Content-Type`ì„ ì§€ì •í•œë‹¤.**

    ```http
    headers: {
        "Content-Type": "multipart/form-data",
        },
    ```

    â†“

    ```javascript
    function onClickSignUpBtn(e) {
        // formDataì— ë‹´ê¸´ ì´ë¯¸ì§€ë¥¼ ì„œë²„ë¡œ ì „ì†¡
        // ì•„ì§ ì„œë²„ êµ¬í˜„ ì¤‘ì´ë¼ ì•„ë˜ ì½”ë“œëŠ” ì„ì‹œë¡œ ì‘ì„±í•œ ê²ƒ
        const formData = new FormData();

        formData.append("email", $emailField.value);
        formData.append("password", $passwordField.value);
        formData.append("nickname", $nicknameField.value);
        formData.append("profile_image", $profileImageUploadField.files[0]);

        fetch("http://localhost:3000/signup", {
            method: "POST",
            headers: {
                "Content-Type": "multipart/form-data",
            },
            body: formData,
        });
    }
    ```

    > `formData.get("profile_image")`ë¥¼ í†µí•´ ë°ì´í„°ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
    > ![formData.get("profile_image")](img/20240501_1.png)

    +\) postmanìœ¼ë¡œ ë³´ë‚´ê¸°
    ![formData2](img/20240501_2.png)

    **2. routerì—ì„œ `multer`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ë¯¸ì§€ë¥¼ ë°›ëŠ”ë‹¤.**

    `routes/userRouter.js`

    ```javascript
    import multer from "multer";
    const upload = multer({ dest: "uploads/" });

    router.post("/signup", upload.single("profile_image"), userController.signUp);
    ```

    **3. `req.file`ë¡œ ì´ë¯¸ì§€ ì •ë³´ë¥¼ í™•ì¸í•œë‹¤.**

    `controllers/userController.js`

    ```javascript
    const signUp = async (req, res) => {
        try {
            const profile_image = req.file;
            const { email, password, nickname } = req.body;
            console.log(profile_image);
            console.log(email, password, nickname);

            const user_id = await User.createUser({
                email,
                password,
                nickname,
                profile_image,
            });

            res.status(200).json(user_id);
        } catch (error) {
            res.status(409).json({ message: error.message });
        }
    };
    ```

-   ê²°ê³¼

    -   ë¡œê·¸ ê²°ê³¼

    ```bash
    // console.log(profile_image)
    {
    fieldname: 'profile_image',
    originalname: 'á„Œá…¡á„…á…­9á„Œá…©.png',
    encoding: '7bit',
    mimetype: 'image/png',
    destination: 'uploads/',
    filename: 'cc695003a5b175de683f8eae5bf00202',
    path: 'uploads/cc695003a5b175de683f8eae5bf00202',
    size: 99145
    }

    // console.log(email, password, nickname)
    user@example.com Asdfasdf1! ìœ ì €1
    ```

    -   `users.json`

    ```json
    [
        {
            "user_id": 4,
            "email": "user@example.com",
            "password": "Asdfasdf1!",
            "nickname": "ìœ ì €1",
            "profile_image": {
                "fieldname": "profile_image",
                "originalname": "á„Œá…¡á„…á…­9á„Œá…©.png",
                "encoding": "7bit",
                "mimetype": "image/png",
                "destination": "uploads/",
                "filename": "cc695003a5b175de683f8eae5bf00202",
                "path": "uploads/cc695003a5b175de683f8eae5bf00202",
                "size": 99145
            },
            "created_at": "2024-05-01 23:34"
        }
    ]
    ```

<br/>

### ì˜¤ëŠ˜ì˜ íšŒê³ 

-   ìŠ¤í¬ëŸ¼ ì¤‘ ì™„ë£Œí•œ ì‘ì—…: `ì»¤ë®¤ë‹ˆí‹°ì›¹ express ì„œë²„ êµ¬í˜„` ing ...
-   ì–´ì œ ë¬¸ì œë¥¼ í•´ê²°í•˜ì§€ ëª»í•œ ì±„ë¡œ ì—…ë¬´ë¥¼ ë§ˆë¬´ë¦¬í–ˆì–´ì„œ ì´í›„ì— íŒ€ì›ë“¤ê³¼ ì£¼ë³€ì˜ ë°±ì—”ë“œ ê°œë°œìì—ê²Œ ì´ë¯¸ì§€ ì²˜ë¦¬ ë°©ì‹ì— ëŒ€í•´ ë¬¼ì–´ë³´ì•˜ë‹¤. ëª¨ë‘ í´ë¼ì´ì–¸íŠ¸ì—ì„œëŠ” `formData`ë¡œ ì²˜ë¦¬í•˜ê³  ì„œë²„ì—ì„œëŠ” `multer`ë¡œ ê·¸ ì´ë¯¸ì§€ë¥¼ ë°›ì•„ì•¼ í•œë‹¤ê³  í–ˆë‹¤. ê·¸ë˜ì„œ ì˜¤ëŠ˜ `multer`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ë¯¸ì§€ë¥¼ ì„œë²„ë¡œ ì „ì†¡í•˜ê³ , `req.file`ë¡œ ì´ë¯¸ì§€ ì •ë³´ë¥¼ í™•ì¸í•˜ëŠ” ë°©ë²•ì„ ì ìš©í–ˆë‹¤.
-   ë¬¸ì œ í•´ê²° ë°©ë²•ì„ ì¡°ì‚¬í•  ë•Œ **ìƒì†Œí•œ ê°œë…ì´ë¼ë„ ë§ì€ ì‚¬ëŒë“¤ì´ ì‚¬ìš© ì¤‘ì´ë¼ë©´ ì¼ë‹¨ ì‹œë„í•´ë³´ëŠ” ê²ƒ** ì´ ì¢‹ì€ ê²ƒ ê°™ë‹¤. ì–´ì œ `multer`ë¥¼ ì•Œê²Œ ëœ í›„ ë°”ë¡œ ì‹œë„í•´ë´¤ìœ¼ë©´ ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ë°ì— ì˜¤ëœ ì‹œê°„ì´ ê±¸ë¦¬ì§€ ì•Šì•˜ì„ ê²ƒ ê°™ë‹¤.

<br/>

### ì°¸ê³  ìë£Œ ë° ë§í¬

-   [express + multer](https://gngsn.tistory.com/37)
